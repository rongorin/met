@*@model IEnumerable<MetopeMVCApp.Models.Security_Price>*@
@model   MetopeMVCApp.Models.SecurityPriceIndexViewModel 
@using GridMvc.Html
 
@section Styles {
    @Styles.Render("~/Content/GridMvc")
    @Styles.Render("~/Content/datetime")
}
@{
    ViewBag.Title = "Index";
} 
<br />   
@Html.Partial("_MsgSuccesFail", Model)

@if (Model.SecurityDetails != null)
{
    @*<h3>
            Security <span><b>@Model.SecurityDetails.Security_Name</b> </span>
        </h3>*@
    <container>
        <div class="col-md-3">
            <div class="panel panel-default ">
                <div class="panel-heading">
                    <h3 class="panel-title">
                          Ticker: <b>@Model.SecurityDetails.Ticker</b>
                    </h3>
                </div>
                @*<div class="panel-body  style='max-height 5;' ">
                    @Model.SecurityDetails.Ticker
                </div>*@
            </div>
        </div>
        <div class="   col-md-3">
            <div class="panel panel-default ">
                <div class="panel-heading">
                    <h3 class="panel-title">
                        Security Type: @Model.SecurityDetails.Security_Type_Code

                    </h3>
                </div>
    
            </div>
        </div>
        <div class="   col-md-3">
            <div class="panel panel-default ">
                <div class="panel-heading">
                    <h3 class="panel-title"> 
                        Price Exchange: @Model.SecurityDetails.Price_Exchange
                    </h3>
                </div>
     
            </div>
        </div>
        <div class="   col-md-3">
            <div class="panel panel-default ">
                <div class="panel-heading">
                    <h3 class="panel-title">

                        Security ID: @Model.SecurityDetails.Security_ID
                    </h3>
                </div>
        
            </div>
        </div>
    </container>
} 

@*<table class="table">
    <tr>
        <th>AllIn Price</th>
        <th>Clean_Price</th>
        <th>Price Sourc</th>
        <th>Yield_To Maturity</th>
        <th>Discount Rate</th>
        <th>Last UpdateDate</th>
        <th>Record Date</th>
        <th>Security Name</th>
        <th></th>

    </tr>
    @foreach (var item in Model.SecurityDetails)
    {
        string selectedRowSD = "";
        if (item.Security_ID == ViewBag.SecurityID )
        {
            selectedRowSD = "success";
        }
        <tr class="@selectedRowSD">
            <td>
                @Html.DisplayFor(modelItem => item.Ticker)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.Security_Name)
            </td>

            <td>
                @Html.DisplayFor(modelItem => item.Current_Market_Price)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.Security_ID)
            </td> 

            <td>
                @Html.ActionLink("Select", "Index", new { SecurityId = item.Security_ID, iEntityId = item.Entity_ID  }) |
            </td>
        </tr>
    }

</table> 

    @*-----------------------------------------SEUCRITY PRICES : -------------------------------------------*@ 
 
<div class="row">
    <div class="col-md-7 ">
        <h4><b>Security Prices</b></h4>
    </div>

    @if (ViewBag.SecurityID != null)
    {
        <div class="col-md-5 col-right">
            <div class="pull-right">  
                <a href="@Url.Action("Index", "SecurityPrice")" class="icon" > 
                    <span class="badge">
                    Go to Price listing
                </span>
                </a> 
            </div>
        </div>
    }
</div>
@*@if (ViewBag.SecurityID != null)
    {*@
        <p>
            @Html.ActionLink("Create New", "Create", new { SecurityId = ViewBag.SecurityID }, null)
        </p>
 
    <div class="code-cut"> 
    @Html.Grid(Model.SecurityPrices).Named("ast").SetRowCssClasses(
                    item => item.Price_Curr == ViewBag.PriceCurr ? "grid-row-selected" : string.Empty).Columns(columns =>
    {
         if (ViewBag.SecurityID == null) {
                columns.Add(c => c.Security_Detail.Ticker)
                    .Titled("Ticker").Filterable(true)
                    .SetWidth(100); 
         } 
        columns.Add(c => c.Currency.Currency_Name)
            .Titled("Current Price Currency").Filterable(true)
            .SetWidth(330);
        
        columns.Add(c => c.Price_Source)
            .Titled("Current Price Source").Filterable(true)
            .SetWidth(180);

        columns.Add(c => c.All_In_Price).Titled("Current All in Price")
                .RenderValueAs(x => String.Format("<span class=\"pull-right\">{0:0,0.00}</span>", x.All_In_Price)).Encoded(false)
                 .Sanitized(false)
                .Filterable(true).SetWidth(180);
     
        
        // columns.Add(c => c.Security_Type_Code ).Titled("Return").Encoded(false).Sanitized(false).RenderValueAs(c => @Html.ActionLink(" ", "../LendReturns/Create", new { id = c.NumberOfRows }, new { @class = "btn btn-success glyphicon glyphicon-share-alt" }));

        //.RenderValueAs(, new { @class = "btn btn-success glyphicon glyphicon-share-alt" }));

        columns.Add(c => c.Clean_Price).Titled("Clean Price").Filterable(false)
                .RenderValueAs(x => String.Format("<span class=\"pull-right\">{0:0,0.00}</span>", x.Clean_Price)).Encoded(false)
                .Sanitized(false)
                .SetWidth(130);
        columns.Add()
                .Encoded(false)
                .Sanitized(false)
                .SetWidth(60)
                .RenderValueAs(c => @<u>
                  @Html.ActionLink("Edit", "Edit", "SecurityPrice", new { EntityId = c.Entity_ID, SecurityId = c.Security_ID, PriceCurr = c.Price_Curr }, null
                     )
                </u>);
        columns.Add()
                .Encoded(false)
                .Sanitized(false)
                .SetWidth(80)
                .RenderValueAs(c => @<u>
                    @Html.ActionLink("Delete", "Delete", "SecurityPrice", new { EntityId = c.Entity_ID, SecurityId = c.Security_ID, PriceCurr = c.Price_Curr }, null)
                </u>);

        columns.Add(c => c.Security_ID).Titled(" ").Encoded(false).Sanitized(false)
              .RenderValueAs(c => @<u>
                @Html.ActionLink("Select", "Index", "SecurityPrice", new { SecurityId = c.Security_ID, iPriceCurr = c.Price_Curr }
                         ,null)
            </u>); 
               
    }).WithPaging(10).Sortable(true)
</div>
 
  @*<h3>
   Security Prices.
</h3>
<table class="table">
    <tr>
        <th>AllIn Price</th>
        <th>Clean_Price</th>
        <th>Price Sourc</th>
        <th>Yield_To Maturity</th>
        <th>Discount Rate</th>
        <th>Last UpdateDate</th>
        <th>Record Date</th>
        <th>Security Name</th>
        <th></th>
          
    </tr>*@ 
@*@foreach (var item in Model )
    {
        string selectedRow = "";
        if (item.Security_ID == ViewBag.SecurityID && item.Price_Curr == ViewBag.PriceCurr)
        {
            selectedRow = "success";
        }
        <tr class="@selectedRow">
            <td>
                @Html.DisplayFor(modelItem => item.All_In_Price)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.Clean_Price)
            </td>

            <td>
                @Html.DisplayFor(modelItem => item.Price_Source)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.Yield_To_Maturity)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.Discount_Rate)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.Last_Update_Date)
            </td>

            <td>
                @Html.DisplayFor(modelItem => item.Record_Date)
            </td>

            <td>
                @Html.DisplayFor(modelItem => item.Security_Detail.Security_Name)
            </td>

            <td>
                @Html.ActionLink("Select", "Index", new { SecurityId = item.Security_ID, iEntityId = item.Entity_ID, iPriceCurr = item.Price_Curr }) |
                @Html.ActionLink("Edit", "Edit", new { SecurityId = item.Security_ID, iEntityId = item.Entity_ID, iPriceCurr = item.Price_Curr }) |
                @Html.ActionLink("Details", "Details", new { SecurityId = item.Security_ID, iEntityId = item.Entity_ID, iPriceCurr = item.Price_Curr }) |
                @Html.ActionLink("Delete", "Delete", new { SecurityId = item.Security_ID, iEntityId = item.Entity_ID, iPriceCurr = item.Price_Curr })
            </td>
        </tr>
    }

    </table>
    *@   
    
    @if (Model.SecurityPriceHistory != null)
    {
        <h4>
            <b>
                History for selected Security Price.
            </b>
        </h4>
        if (!Model.SecurityPriceHistory.Any())
        {
            <p>no price history for  @ViewBag.PriceCurr </p>
        }
        else
        {
            <table class="table">
                <tr>
                    <th>Historic Date</th>
                    <th>Currency</th>
                    <th>All In Price</th>
                    <th>Clean Price</th>
                    <th>Price Source</th>
                    <th>YTM</th> 
                    <th>Discount Rate</th>
                </tr>
                @foreach (var item in Model.SecurityPriceHistory)
                {
                    <tr>
                        <td>
                            @String.Format("{0:d MMM yyyy}", item.Price_DateTime)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.Currency.Currency_Name)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.All_In_Price)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.Clean_Price)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.Price_Source)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.Yield_To_Maturity)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.Discount_Rate)
                        </td>
                        <td>
                            @Html.ActionLink("Edit", "EditHistory", "SecurityPrice", new { EntityId = item.Entity_ID, SecurityId = item.Security_ID, PriceCurr = item.Price_Curr, PriceDateTime = item.Price_DateTime }, null)


                        </td>

                    </tr>
                }

            </table>
        }
    }

    @section Scripts {
        @Scripts.Render("~/bundles/GridMvc") 

        @*<script>
            $(function () {
                pageGrids.ast.onRowSelect(function (e) {
                    //alert(e.row.Price_Curr);

                    $.post("/SecurityPrice?SecurityId=" + e.row.Security_ID, function (data) {
                        alert(data.Status);
                        if (data.Status <= 0) {
                            alert(data.Message);
                            return;
                        }
                    });
                });
            });
        </script*@> 
}